import{r as c,A as I,_ as z,g as M,m as U,f as H,C as V,h as q,p as W,i as X,R as G,b as Y,j as l,c as J,d as K,e as Q}from"./index-21055db3.js";import{A as Z,U as P}from"./UtilService-c94d23f7.js";import{F,C as N}from"./index-6fd6f147.js";import{L as ee,B as te,P as ae}from"./index-3871225b.js";import{B as ne}from"./index-ada8d22f.js";import{R as O}from"./row-36c7c26f.js";import{a as oe,C as A,S as k}from"./index-7fa0c08c.js";import{u as re}from"./useForceUpdate-c784bdaf.js";var se={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M862 465.3h-81c-4.6 0-9 2-12.1 5.5L550 723.1V160c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v563.1L255.1 470.8c-3-3.5-7.4-5.5-12.1-5.5h-81c-6.8 0-10.5 8.1-6 13.2L487.9 861a31.96 31.96 0 0048.3 0L868 478.5c4.5-5.2.8-13.2-6-13.2z"}}]},name:"arrow-down",theme:"outlined"};const ie=se;var le=function(e,o){return c.createElement(I,z({},e,{ref:o,icon:ie}))},ce=c.forwardRef(le);const de=ce;var ue={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M868 545.5L536.1 163a31.96 31.96 0 00-48.3 0L156 545.5a7.97 7.97 0 006 13.2h81c4.6 0 9-2 12.1-5.5L474 300.9V864c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V300.9l218.9 252.3c3 3.5 7.4 5.5 12.1 5.5h81c6.8 0 10.5-8 6-13.2z"}}]},name:"arrow-up",theme:"outlined"};const fe=ue;var me=function(e,o){return c.createElement(I,z({},e,{ref:o,icon:fe}))},pe=c.forwardRef(me);const ge=pe,he=t=>{const{value:e,formatter:o,precision:a,decimalSeparator:s,groupSeparator:p="",prefixCls:f}=t;let d;if(typeof o=="function")d=o(e);else{const r=String(e),g=r.match(/^(-?)(\d*)(\.(\d+))?$/);if(!g||r==="-")d=r;else{const v=g[1];let m=g[2]||"0",u=g[4]||"";m=m.replace(/\B(?=(\d{3})+(?!\d))/g,p),typeof a=="number"&&(u=u.padEnd(a,"0").slice(0,a>0?a:0)),u&&(u=`${s}${u}`),d=[c.createElement("span",{key:"int",className:`${f}-content-value-int`},v,m),u&&c.createElement("span",{key:"decimal",className:`${f}-content-value-decimal`},u)]}}return c.createElement("span",{className:`${f}-content-value`},d)},ve=he,xe=t=>{const{componentCls:e,marginXXS:o,padding:a,colorTextDescription:s,titleFontSize:p,colorTextHeading:f,contentFontSize:d,fontFamily:r}=t;return{[`${e}`]:Object.assign(Object.assign({},H(t)),{[`${e}-title`]:{marginBottom:o,color:s,fontSize:p},[`${e}-skeleton`]:{paddingTop:a},[`${e}-content`]:{color:f,fontSize:d,fontFamily:r,[`${e}-content-value`]:{display:"inline-block",direction:"ltr"},[`${e}-content-prefix, ${e}-content-suffix`]:{display:"inline-block"},[`${e}-content-prefix`]:{marginInlineEnd:o},[`${e}-content-suffix`]:{marginInlineStart:o}}})}},be=t=>{const{fontSizeHeading3:e,fontSize:o}=t;return{titleFontSize:o,contentFontSize:e}},Se=M("Statistic",t=>{const e=U(t,{});return[xe(e)]},be);var we=globalThis&&globalThis.__rest||function(t,e){var o={};for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&e.indexOf(a)<0&&(o[a]=t[a]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,a=Object.getOwnPropertySymbols(t);s<a.length;s++)e.indexOf(a[s])<0&&Object.prototype.propertyIsEnumerable.call(t,a[s])&&(o[a[s]]=t[a[s]]);return o};const je=t=>{const{prefixCls:e,className:o,rootClassName:a,style:s,valueStyle:p,value:f=0,title:d,valueRender:r,prefix:g,suffix:v,loading:m=!1,formatter:u,precision:S,decimalSeparator:C=".",groupSeparator:w=",",onMouseEnter:_,onMouseLeave:E}=t,n=we(t,["prefixCls","className","rootClassName","style","valueStyle","value","title","valueRender","prefix","suffix","loading","formatter","precision","decimalSeparator","groupSeparator","onMouseEnter","onMouseLeave"]),{getPrefixCls:i,direction:b,statistic:x}=c.useContext(V),h=i("statistic",e),[j,R,$]=Se(h),y=c.createElement(ve,{decimalSeparator:C,groupSeparator:w,prefixCls:h,formatter:u,precision:S,value:f}),B=q(h,{[`${h}-rtl`]:b==="rtl"},x==null?void 0:x.className,o,a,R,$),D=W(n,{aria:!0,data:!0});return j(c.createElement("div",Object.assign({},D,{className:B,style:Object.assign(Object.assign({},x==null?void 0:x.style),s),onMouseEnter:_,onMouseLeave:E}),d&&c.createElement("div",{className:`${h}-title`},d),c.createElement(oe,{paragraph:!1,loading:m,className:`${h}-skeleton`},c.createElement("div",{style:p,className:`${h}-content`},g&&c.createElement("span",{className:`${h}-content-prefix`},g),r?r(y):y,v&&c.createElement("span",{className:`${h}-content-suffix`},v)))))},T=je,Ce=[["Y",1e3*60*60*24*365],["M",1e3*60*60*24*30],["D",1e3*60*60*24],["H",1e3*60*60],["m",1e3*60],["s",1e3],["S",1]];function ye(t,e){let o=t;const a=/\[[^\]]*]/g,s=(e.match(a)||[]).map(r=>r.slice(1,-1)),p=e.replace(a,"[]"),f=Ce.reduce((r,g)=>{let[v,m]=g;if(r.includes(v)){const u=Math.floor(o/m);return o-=u*m,r.replace(new RegExp(`${v}+`,"g"),S=>{const C=S.length;return u.toString().padStart(C,"0")})}return r},p);let d=0;return f.replace(a,()=>{const r=s[d];return d+=1,r})}function Oe(t,e){const{format:o=""}=e,a=new Date(t).getTime(),s=Date.now(),p=Math.max(a-s,0);return ye(p,o)}var _e=globalThis&&globalThis.__rest||function(t,e){var o={};for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&e.indexOf(a)<0&&(o[a]=t[a]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,a=Object.getOwnPropertySymbols(t);s<a.length;s++)e.indexOf(a[s])<0&&Object.prototype.propertyIsEnumerable.call(t,a[s])&&(o[a[s]]=t[a[s]]);return o};const Ee=1e3/30;function $e(t){return new Date(t).getTime()}const Fe=t=>{const{value:e,format:o="HH:mm:ss",onChange:a,onFinish:s}=t,p=_e(t,["value","format","onChange","onFinish"]),f=re(),d=c.useRef(null),r=()=>{s==null||s(),d.current&&(clearInterval(d.current),d.current=null)},g=()=>{const u=$e(e);u>=Date.now()&&(d.current=setInterval(()=>{f(),a==null||a(u-Date.now()),u<Date.now()&&r()},Ee))};c.useEffect(()=>(g(),()=>{d.current&&(clearInterval(d.current),d.current=null)}),[e]);const v=(u,S)=>Oe(u,Object.assign(Object.assign({},S),{format:o})),m=u=>X(u,{title:void 0});return c.createElement(T,Object.assign({},p,{value:e,valueRender:m,formatter:v}))},Te=c.memo(Fe);T.Countdown=Te;var L=globalThis&&globalThis.__assign||function(){return L=Object.assign||function(t){for(var e,o=1,a=arguments.length;o<a;o++){e=arguments[o];for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s])}return t},L.apply(this,arguments)},Re=c.forwardRef(function(t,e){return G.createElement(ne,L({},t,{chartType:"Liquid",ref:e}))});const Pe=Re,Me=()=>{var E;const[t,e]=c.useState([]),[o,a]=c.useState([]),[s,p]=c.useState(!0),[f,d]=c.useState(0),[r,g]=c.useState([]),[v]=F.useForm(),m=Y(),u=n=>{P.obtenerComboPeriodo({id_carrera:n}).then(i=>{var b,x;if(i.data.ok)if(i.data.data.configuracion===null)p(!1);else{const h=(x=(b=i==null?void 0:i.data)==null?void 0:b.data)==null?void 0:x.periodo.map((j,R)=>{var $,y;return{value:j.value,label:j.label,disabled:((y=($=i==null?void 0:i.data)==null?void 0:$.data)==null?void 0:y.periodo.length)-i.data.data.configuracion.periodos_desercion<R}});e(h)}})},S=()=>{P.getComboCarreras().then(n=>{n.data.ok&&a(n.data.data)})},C=n=>{m(J());const i=v.getFieldsValue();P.obtenerDataPeriodo(i).then(b=>{d(b.data.total);const x=b.data.data.sort((h,j)=>j.row-h.row);g(x)}).catch(b=>{m(K({success:!1,title:"Error al obtener datos",message:b.response.data.message}))}).finally(()=>m(Q()))};c.useEffect(()=>{S()},[]);const w=r.map(n=>({codigo:n==null?void 0:n.codigo,cantidad_estudiantes:n==null?void 0:n.total_estudiantes}));console.log(r);const _=[{id:1,graphic:l.jsx(ee,{data:w,xField:"codigo",yField:"cantidad_estudiantes",width:450,height:350,point:{shapeField:"square",sizeField:4},interaction:{tooltip:{marker:!1}},style:{lineWidth:2}})},{id:2,graphic:l.jsx(te,{data:w,xField:"codigo",yField:"cantidad_estudiantes",width:450,paddingRight:80,style:{maxWidth:25},markBackground:{label:{text:({originData:n})=>{var i;return console.log(n),`${((n==null?void 0:n.cantidad_estudiantes)/((i=w[0])==null?void 0:i.cantidad_estudiantes)*100).toFixed(2)}% | ${n==null?void 0:n.cantidad_estudiantes}`},position:"right",dx:80}},scale:{y:{domain:[0,(E=w[0])==null?void 0:E.cantidad_estudiantes]}},interaction:{elementHighlightByColor:!1}})},{id:3,graphic:l.jsx(ae,{data:w,colorField:"codigo",width:450,height:350,angleField:"cantidad_estudiantes",label:{text:"codigo",style:{fontWeight:"bold"}},legend:{color:{title:!1,position:"right",rowPadding:5}}})}];return l.jsxs("div",{children:[l.jsx("h2",{children:"Indicador Tasa de Desercion"}),l.jsx(O,{children:l.jsx(A,{style:{width:"100%"},children:l.jsxs(F,{form:v,layout:"vertical",children:[!s&&l.jsx(Z,{message:"No existen datos de configuracion",description:"Asigne los datos de configuracion para esta carrera antes de continuar",type:"warning",showIcon:!0}),l.jsxs(O,{justify:"space-around",children:[l.jsx(N,{xs:24,sm:24,md:7,lg:7,xl:8,children:l.jsx(F.Item,{label:"Carrera",name:"carrera",children:l.jsx(k,{placeholder:"Seleccione una carrera",options:o,onChange:n=>{u(n)}})})}),l.jsx(N,{xs:24,sm:24,md:7,lg:7,xl:8,children:l.jsx(F.Item,{label:"Periodo",name:"periodo",children:l.jsx(k,{placeholder:"Seleccione un periodo",options:t,onChange:n=>{C()}})})})]})]})})}),r.length>0&&l.jsxs(A,{children:[l.jsx(O,{justify:"space-around",children:r.map((n,i)=>l.jsx(N,{xs:12,sm:12,md:12,lg:10,xl:4,children:l.jsxs(A,{title:n.codigo,style:{borderRadius:12,boxShadow:"0 4px 8px rgba(0,0,0,0.1)",margin:"10px",textAlign:"center"},headStyle:{fontSize:"1.3em",color:"#BBB",textAlign:"center"},children:[l.jsx(Pe,{height:150,percent:parseFloat((n.total_estudiantes/f).toFixed(4))}),l.jsx(T,{title:r[i-1]?r[i-1].total_estudiantes<n.total_estudiantes?"Matriculados":"Desertados":"-",value:r[i-1]?r[i-1].total_estudiantes<n.total_estudiantes?n.total_estudiantes-r[i-1].total_estudiantes:r[i-1].total_estudiantes-n.total_estudiantes:0,valueStyle:{color:r[i-1]?r[i-1].total_estudiantes<n.total_estudiantes?"#3f8600":"#cf1322":""},prefix:r[i-1]?r[i-1].total_estudiantes<n.total_estudiantes?l.jsx(ge,{}):l.jsx(de,{}):"",suffix:r[i-1]?r[i-1].total_estudiantes<n.total_estudiantes?"+":"-":""}),l.jsx(T,{title:"Tasa deserciÃ³n",value:parseFloat(((f-n.total_estudiantes)/f*100).toFixed(2)),suffix:"%"})]})},i))}),l.jsx(O,{}),l.jsxs(O,{justify:"space-evenly",children:[_[2].graphic,_[0].graphic]})]})]})};export{Me as default};
