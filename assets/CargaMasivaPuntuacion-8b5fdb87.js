import{r,A as $,_ as H,b as R,c as D,d as h,e as F,j as e,U as _,B as v}from"./index-21055db3.js";import{U as x,A as T}from"./UtilService-c94d23f7.js";import{E as J,I as K,U as Q,m as W}from"./ExcelService-9f11adce.js";import{F as c,C as b}from"./index-6fd6f147.js";import{T as X}from"./index-28b2f492.js";import{T as O}from"./index-c25f1d1d.js";import{I as z}from"./index-03b40648.js";import{S as C,P as Y,C as Z}from"./index-7fa0c08c.js";import{R as k}from"./row-36c7c26f.js";import"./context-1fc4877a.js";import"./useForceUpdate-c784bdaf.js";import"./EyeOutlined-6816cc68.js";import"./EditOutlined-747367f7.js";import"./styleChecker-2da1bf7b.js";import"./TextArea-1e7806d6.js";import"./BaseInput-9763bb7b.js";var ee={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M696 480H328c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h368c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8z"}},{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}}]},name:"minus-circle",theme:"outlined"};const se=ee;var te=function(u,i){return r.createElement($,H({},u,{ref:i,icon:se}))},ae=r.forwardRef(te);const oe=ae,ne=n=>{const u=R(),[i,I]=r.useState([]),[j,S]=r.useState([]),[m,M]=r.useState({contador:null,sumatoria:null}),[f]=c.useForm();r.useEffect(()=>{n.status&&P()},[n.status]);const P=()=>{u(D()),x.obtenerLogrosAprendizajeDocente(n.datos).then(l=>{I(l.data.data),S(l.data.configuracion)}).catch(l=>{console.log(l),u(h({success:!1,title:"Error al obtetner los periodos",message:l.response.data.error}))}).finally(()=>u(F()))},y=()=>{n.close(),f.setFieldsValue({puntuacion:[]}),M({contador:null,sumatoria:null})},A=(l,o)=>{var d,p;M({contador:(d=o==null?void 0:o.puntuacion)==null?void 0:d.length,sumatoria:(p=o==null?void 0:o.puntuacion)==null?void 0:p.filter(a=>(a==null?void 0:a.puntuacion)!==void 0).reduce((a,g)=>a+g.puntuacion,0)})},E=l=>{J.descargarFormatoPuntuacion({...l,datos:n.datos}).then(async o=>{const d=new Blob([o.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),p=window.URL.createObjectURL(d),a=document.createElement("a");a.href=p,a.download=`CARGA MASIVA ${periodo[0].label}.xlsx`,document.body.appendChild(a),a.click(),a.remove()}).catch(o=>{console.log(o),u(h({success:!1,title:"Error al obtetner los periodos",message:o.response.data.error}))}).finally(()=>u(F()))},w=()=>{const l=f.getFieldsValue().puntuacion.map((o,d)=>({...o,pregunta:d+1}));f.setFieldsValue({puntuacion:l})};return e.jsxs(_,{open:n.status,title:"Asignacion de puntos",style:{userSelect:"none"},onCancel:y,footer:!1,children:[m.contador>0&&m.contador!==null&&e.jsxs(e.Fragment,{children:[e.jsxs(X,{color:j.puntuacion<m.sumatoria?"red":j.puntuacion>m.sumatoria?"gold":"green",children:["Puntuacion total: ",m.sumatoria]}),j.puntuacion<m.sumatoria?e.jsx(O.Text,{type:"danger",children:"Te pasaste!"}):j.puntuacion>m.sumatoria?e.jsx(O.Text,{type:"warning",children:"Faltan puntos"}):e.jsx(O.Text,{type:"success",children:"Excelente!"})]}),e.jsxs(c,{form:f,onValuesChange:A,onFinish:E,children:[e.jsx(c.List,{name:"puntuacion",children:(l,{add:o,remove:d})=>e.jsxs(e.Fragment,{children:[e.jsxs("table",{style:{width:"100%",marginBlock:"20px"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{backgroundColor:"#e6f4ff"},children:[e.jsx("th",{style:{border:"1px dotted #91caff"},children:"N° Pregunta"}),e.jsx("th",{style:{border:"1px dotted #91caff"},children:"Logro de aprendizaje"}),e.jsx("th",{colSpan:2,style:{border:"1px dotted #91caff"},children:"Puntuacion"})]})}),e.jsx("tbody",{children:l.map(({key:p,name:a,...g})=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx(c.Item,{...g,name:[a,"pregunta"],children:e.jsx(z,{readOnly:!0})})}),e.jsx("td",{children:e.jsx(c.Item,{...g,name:[a,"logro"],children:e.jsx(C,{style:{width:"100%"},placeholder:"Seleccione un logro...",options:i})})}),e.jsx("td",{children:e.jsx(c.Item,{...g,name:[a,"puntuacion"],children:e.jsx(z,{style:{width:"100%"},placeholder:"Last Name"})})}),e.jsx("td",{style:{width:"40px",height:"30px",display:"flex",justifyContent:"center",alignContent:"center"},children:e.jsx(oe,{onClick:()=>d(a)})})]}))})]}),e.jsx(c.Item,{children:e.jsx(v,{type:"dashed",onClick:()=>{o(),w()},block:!0,icon:e.jsx(Y,{}),children:"Add field"})})]})}),e.jsxs(k,{justify:"end",children:[e.jsx(c.Item,{children:e.jsx(v,{type:"primary",htmlType:"submit",children:"Submit"})}),e.jsx(c.Item,{children:e.jsx(v,{onClick:y,children:"Cerrar"})})]})]})]})},Me=()=>{const[n]=c.useForm(),{Dragger:u}=Q,i=R(),[I,j]=r.useState([]),[S,m]=r.useState([]),[M,f]=r.useState([]),[P,y]=r.useState([]),[A,E]=r.useState([]),[w,l]=r.useState([]),[o,d]=r.useState({}),[p,a]=r.useState(!1);r.useEffect(()=>{n.setFieldsValue({materias:A})},[A]);const g=()=>{i(D()),x.getComboCarreras().then(t=>{t.data.ok&&j(t.data.data)}).catch(t=>{console.log(t),i(h({success:!1,title:"Error al asignar los logros",message:t.response.data.error}))}).finally(()=>i(F()))},L=()=>{const t=n.getFieldsValue();n.resetFields(["docente"]),x.obtenerDocentesPeriodoCarrera(t).then(s=>{s.data.ok&&m(s.data.data)}).catch(s=>{console.log(s),i(h({success:!1,title:"Error al obtetner los docentes",message:s.response.data.error}))})},B=t=>{x.obtenerPeriodoNominaCarreraDocenteMateria(t).then(s=>{s.data.ok&&f(s.data.data)}).catch(s=>{console.log(s),i(h({success:!1,title:"Error al obtetner los periodos",message:s.response.data.error}))})},U=()=>{const t=n.getFieldsValue();x.obtenerMaterias(t).then(s=>{s.data.ok&&y(s.data.data)}).catch(s=>{console.log(s),i(h({success:!1,title:"Error al obtetner las materias",message:s.response.data.error}))}).finally(()=>{})},N=()=>{const t=n.getFieldsValue();x.obtenerGruposDocenteMateria(t).then(s=>{l(s.data.data)}).catch(s=>{console.log(s),i(h({success:!1,title:"Error al obtetner los grupos",message:s.response.data.error}))})},G=({file:t,onSuccess:s})=>{s("ok"),W.success(`${t.name} cargado exitosamente.`)};r.useEffect(()=>{g()},[]);const q={name:"file",multiple:!1,maxCount:1,onRemove:()=>{d({})},accept:".xls,.xlsx",onChange:t=>{if(t.file.status==="removed")return;const s=t.file.originFileObj;d(s)},customRequest:G},V=()=>{i(D()),x.subirAsignacionPuntosMasiva({file:o}).then(t=>{t.data.ok&&(n.resetFields(),d({}),E([]),y([]),i(h({success:!0,title:"Puntuacion asignada correctamente"})))}).catch(t=>{console.log(t),i(h({success:!1,title:"Error al asignar puntuacion a los logros",message:t.response.data.error}))}).finally(()=>i(F()))};return e.jsxs("div",{children:[e.jsx(ne,{status:p,datos:n.getFieldsValue(),close:()=>a(!1)}),e.jsx("h2",{children:"Puntuacion de los logros de aprendizaje"}),e.jsxs(Z,{children:[e.jsx(T,{style:{marginBlock:"10px"},message:"Aqui se descargara el formato de los estudiantes inscritos por materia y docentes(Opcional)",showIcon:!0,type:"info"}),e.jsxs(c,{form:n,layout:"vertical",onFinish:()=>a(!0),children:[e.jsxs(k,{justify:"space-between",children:[e.jsx(b,{xs:24,sm:24,md:11,lg:11,xl:11,children:e.jsx(c.Item,{label:"Carreras",name:"carrera",children:e.jsx(C,{placeholder:"Seleccione una carrera...",options:I,onChange:B})})}),e.jsx(b,{xs:24,sm:24,md:11,lg:11,xl:11,children:e.jsx(c.Item,{label:"Periodos",name:"periodos",children:e.jsx(C,{placeholder:"Seleccione un periodo...",options:M,onChange:U})})}),e.jsx(b,{xs:24,sm:24,md:11,lg:11,xl:11,children:e.jsx(c.Item,{label:"Materia",name:"materia",children:e.jsx(C,{maxTagCount:"responsive",placeholder:"Seleccione una materia...",options:P,onChange:L})})}),e.jsx(b,{xs:24,sm:24,md:11,lg:11,xl:11,children:e.jsx(c.Item,{label:"Docente",name:"docente",rules:[{required:!0,message:"Debe seleccionar un docente"}],children:e.jsx(C,{maxTagCount:"responsive",placeholder:"Seleccione un docente...",onChange:N,options:S})})}),e.jsx(b,{xs:24,sm:24,md:11,lg:11,xl:11,children:e.jsx(c.Item,{label:"Grupo",name:"grupo",rules:[{required:!0,message:"Debe seleccionar un grupo"}],children:e.jsx(C,{maxTagCount:"responsive",placeholder:"Seleccione un grupo...",options:w})})})]}),e.jsxs(k,{justify:"end",style:{marginBlock:"30px"},children:[e.jsx(v,{htmlType:"submit",disabled:!S.length>0,type:"primary",children:"Asignar puntuación"}),e.jsx(v,{onClick:V,disabled:!Object.keys(o).length>0,type:"primary",children:"Subir documento"})]}),e.jsx(k,{children:e.jsx(b,{style:{width:"100%"},children:e.jsxs(u,{...q,children:[e.jsx(T,{style:{marginBlock:"10px"},message:"Una vez llenado el formato, suba el archivo para ingresar los datos al sistema.",showIcon:!0,type:"warning"}),e.jsx("p",{className:"ant-upload-drag-icon",children:e.jsx(K,{})}),e.jsx("p",{className:"ant-upload-text",children:"Haga clic o arrastre el archivo a esta área para cargarlo"}),e.jsx("p",{className:"ant-upload-hint",children:"Solo permite subir un solo archivo archivo de tipo excel"})]})})})]})]})]})};export{Me as default};
